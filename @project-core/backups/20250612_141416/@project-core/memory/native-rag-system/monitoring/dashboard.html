<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Native RAG System V1.0 - Production Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
        }
        
        .status-bar {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .status-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            flex: 1;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            text-align: center;
        }
        
        .status-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .status-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .status-healthy { color: #27ae60; }
        .status-warning { color: #f39c12; }
        .status-critical { color: #e74c3c; }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .metric-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .metric-card h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .metric-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #7f8c8d;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .progress-healthy { background: #27ae60; }
        .progress-warning { background: #f39c12; }
        .progress-critical { background: #e74c3c; }
        
        .alerts-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .alerts-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .alert-item {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid;
        }
        
        .alert-high {
            background: #fdf2f2;
            border-color: #e74c3c;
        }
        
        .alert-medium {
            background: #fef9e7;
            border-color: #f39c12;
        }
        
        .alert-low {
            background: #f0f9ff;
            border-color: #3498db;
        }
        
        .timestamp {
            font-size: 0.8em;
            color: #95a5a6;
            margin-top: 5px;
        }
        
        .refresh-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(46, 204, 113, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9em;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 Native RAG System V1.0</h1>
            <div class="subtitle">Production Monitoring Dashboard - GRUPO US VIBECODE SYSTEM</div>
        </div>
        
        <div class="refresh-indicator" id="refreshIndicator">
            🔄 Auto-refresh: 10s
        </div>
        
        <div class="status-bar">
            <div class="status-card">
                <h3>System Status</h3>
                <div class="status-value" id="systemStatus">Loading...</div>
                <div>Overall Health</div>
            </div>
            <div class="status-card">
                <h3>Uptime</h3>
                <div class="status-value" id="uptime">--:--:--</div>
                <div>Hours:Minutes:Seconds</div>
            </div>
            <div class="status-card">
                <h3>Active Alerts</h3>
                <div class="status-value" id="alertCount">0</div>
                <div>Last Hour</div>
            </div>
            <div class="status-card">
                <h3>Metrics Tracked</h3>
                <div class="status-value" id="metricsCount">0</div>
                <div>Performance Indicators</div>
            </div>
        </div>
        
        <div class="metrics-grid" id="metricsGrid">
            <div class="loading pulse">
                📊 Loading metrics data...
            </div>
        </div>
        
        <div class="alerts-section">
            <h3>🚨 Recent Alerts</h3>
            <div id="alertsList">
                <div class="loading pulse">
                    📋 Loading alerts...
                </div>
            </div>
        </div>
    </div>

    <script>
        class ProductionDashboard {
            constructor() {
                this.dashboardFile = './dashboard_data.json';
                this.refreshInterval = 10000; // 10 seconds
                this.isLoading = false;
                
                this.init();
            }
            
            init() {
                this.loadDashboardData();
                this.startAutoRefresh();
            }
            
            async loadDashboardData() {
                if (this.isLoading) return;
                
                this.isLoading = true;
                
                try {
                    const response = await fetch(this.dashboardFile + '?t=' + Date.now());
                    const data = await response.json();
                    
                    this.updateDashboard(data);
                    this.updateRefreshIndicator('✅ Updated');
                    
                } catch (error) {
                    console.error('Failed to load dashboard data:', error);
                    this.updateRefreshIndicator('❌ Error');
                } finally {
                    this.isLoading = false;
                }
            }
            
            updateDashboard(data) {
                // Update status bar
                this.updateSystemStatus(data.system_status);
                this.updateUptime(data.uptime_seconds);
                this.updateAlertCount(data.alert_counts.total);
                this.updateMetricsCount(Object.keys(data.current_metrics).length);
                
                // Update metrics grid
                this.updateMetricsGrid(data.summary_statistics, data.baselines);
                
                // Update alerts
                this.updateAlertsList(data.recent_alerts);
            }
            
            updateSystemStatus(status) {
                const element = document.getElementById('systemStatus');
                element.className = 'status-value status-' + status;
                
                const statusText = {
                    'healthy': '✅ Healthy',
                    'warning': '⚠️ Warning',
                    'critical': '🚨 Critical',
                    'unknown': '❓ Unknown'
                };
                
                element.textContent = statusText[status] || status;
            }
            
            updateUptime(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = Math.floor(seconds % 60);
                
                document.getElementById('uptime').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            
            updateAlertCount(count) {
                const element = document.getElementById('alertCount');
                element.textContent = count;
                element.className = 'status-value ' + (count > 0 ? 'status-warning' : 'status-healthy');
            }
            
            updateMetricsCount(count) {
                document.getElementById('metricsCount').textContent = count;
            }
            
            updateMetricsGrid(statistics, baselines) {
                const grid = document.getElementById('metricsGrid');
                grid.innerHTML = '';
                
                for (const [metricName, stats] of Object.entries(statistics)) {
                    const baseline = baselines[metricName];
                    if (!baseline) continue;
                    
                    const card = this.createMetricCard(metricName, stats, baseline);
                    grid.appendChild(card);
                }
            }
            
            createMetricCard(metricName, stats, baseline) {
                const card = document.createElement('div');
                card.className = 'metric-card';
                
                const title = metricName.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                const value = stats.current.toFixed(1);
                const unit = this.getMetricUnit(metricName);
                
                // Determine status
                const status = this.getMetricStatus(metricName, stats.current, baseline);
                const progressPercent = this.calculateProgressPercent(metricName, stats.current, baseline);
                
                card.innerHTML = `
                    <h4>${title}</h4>
                    <div class="metric-value status-${status}">${value}${unit}</div>
                    <div class="progress-bar">
                        <div class="progress-fill progress-${status}" style="width: ${progressPercent}%"></div>
                    </div>
                    <div class="metric-details">
                        <span>Avg: ${stats.average.toFixed(1)}${unit}</span>
                        <span>Target: ${baseline.target}${unit}</span>
                    </div>
                `;
                
                return card;
            }
            
            getMetricUnit(metricName) {
                const units = {
                    'bridge_reuse_rate': '%',
                    'api_reduction_rate': '%',
                    'success_rate': '%',
                    'error_rate': '%',
                    'memory_consultation_speed': 'ms',
                    'crosscheck_analysis_time': 'ms',
                    'ecl_pipeline_performance': 'ms',
                    'embedding_service_time': 'ms',
                    'knowledge_graph_time': 'ms'
                };
                return units[metricName] || '';
            }
            
            getMetricStatus(metricName, value, baseline) {
                // For rates and percentages (higher is better)
                if (['bridge_reuse_rate', 'api_reduction_rate', 'success_rate'].includes(metricName)) {
                    if (value >= baseline.target) return 'healthy';
                    if (value >= baseline.warning) return 'warning';
                    return 'critical';
                }
                
                // For times and error rates (lower is better)
                if (value <= baseline.target) return 'healthy';
                if (value <= baseline.warning) return 'warning';
                return 'critical';
            }
            
            calculateProgressPercent(metricName, value, baseline) {
                // For rates and percentages (higher is better)
                if (['bridge_reuse_rate', 'api_reduction_rate', 'success_rate'].includes(metricName)) {
                    return Math.min(100, (value / baseline.target) * 100);
                }
                
                // For times (lower is better)
                const maxValue = baseline.critical * 1.5;
                return Math.max(0, 100 - ((value / maxValue) * 100));
            }
            
            updateAlertsList(alerts) {
                const list = document.getElementById('alertsList');
                
                if (!alerts || alerts.length === 0) {
                    list.innerHTML = '<div style="text-align: center; color: #27ae60; padding: 20px;">✅ No recent alerts</div>';
                    return;
                }
                
                list.innerHTML = alerts.map(alert => `
                    <div class="alert-item alert-${alert.severity}">
                        <strong>${alert.component}</strong>: ${alert.message}
                        <div class="timestamp">${new Date(alert.timestamp).toLocaleString()}</div>
                    </div>
                `).join('');
            }
            
            updateRefreshIndicator(text) {
                const indicator = document.getElementById('refreshIndicator');
                indicator.textContent = text;
                
                setTimeout(() => {
                    indicator.textContent = '🔄 Auto-refresh: 10s';
                }, 2000);
            }
            
            startAutoRefresh() {
                setInterval(() => {
                    this.loadDashboardData();
                }, this.refreshInterval);
            }
        }
        
        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new ProductionDashboard();
        });
    </script>
</body>
</html>
